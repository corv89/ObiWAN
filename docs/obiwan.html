<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--  This file is generated by Nim. -->
<html xmlns="https://www.w3.org/1999/xhtml" xml:lang="en" lang="en" data-theme="auto">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>src/obiwan</title>

<!-- Google fonts -->
<link href='https://fonts.googleapis.com/css?family=Lato:400,600,900' rel='stylesheet' type='text/css'/>
<link href='https://fonts.googleapis.com/css?family=Source+Code+Pro:400,500,600' rel='stylesheet' type='text/css'/>

<!-- Favicon -->
<link rel="shortcut icon" href="data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AAAAAAUAAAAF////AP///wD///8A////AP///wD///8A////AP///wD///8A////AAAAAAIAAABbAAAAlQAAAKIAAACbAAAAmwAAAKIAAACVAAAAWwAAAAL///8A////AP///wD///8A////AAAAABQAAADAAAAAYwAAAA3///8A////AP///wD///8AAAAADQAAAGMAAADAAAAAFP///wD///8A////AP///wAAAACdAAAAOv///wD///8A////AP///wD///8A////AP///wD///8AAAAAOgAAAJ3///8A////AP///wAAAAAnAAAAcP///wAAAAAoAAAASv///wD///8A////AP///wAAAABKAAAAKP///wAAAABwAAAAJ////wD///8AAAAAgQAAABwAAACIAAAAkAAAAJMAAACtAAAAFQAAABUAAACtAAAAkwAAAJAAAACIAAAAHAAAAIH///8A////AAAAAKQAAACrAAAAaP///wD///8AAAAARQAAANIAAADSAAAARf///wD///8AAAAAaAAAAKsAAACk////AAAAADMAAACcAAAAnQAAABj///8A////AP///wAAAAAYAAAAGP///wD///8A////AAAAABgAAACdAAAAnAAAADMAAAB1AAAAwwAAAP8AAADpAAAAsQAAAE4AAAAb////AP///wAAAAAbAAAATgAAALEAAADpAAAA/wAAAMMAAAB1AAAAtwAAAOkAAAD/AAAA/wAAAP8AAADvAAAA3gAAAN4AAADeAAAA3gAAAO8AAAD/AAAA/wAAAP8AAADpAAAAtwAAAGUAAAA/AAAA3wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAADfAAAAPwAAAGX///8A////AAAAAEgAAADtAAAAvwAAAL0AAADGAAAA7wAAAO8AAADGAAAAvQAAAL8AAADtAAAASP///wD///8A////AP///wD///8AAAAAO////wD///8A////AAAAAIcAAACH////AP///wD///8AAAAAO////wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A//8AAP//AAD4HwAA7/cAAN/7AAD//wAAoYUAAJ55AACf+QAAh+EAAAAAAADAAwAA4AcAAP5/AAD//wAA//8AAA=="/>
<link rel="icon" type="image/png" sizes="32x32" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAAB3RJTUUH4QQQEwksSS9ZWwAAAk1JREFUWMPtll2ITVEUx39nn/O7Y5qR8f05wtCUUr6ZIS++8pEnkZInPImneaCQ5METNdOkeFBKUhMPRIkHKfEuUZSUlGlKPN2TrgfncpvmnntnmlEyq1Z7t89/rf9a6+y99oZxGZf/XeIq61EdtgKXgdXA0xrYAvBjOIF1AI9zvjcC74BSpndrJPkBWDScTF8Aa4E3wDlgHbASaANmVqlcCnwHvgDvgVfAJ+AikAAvgfVZwLnSVZHZaOuKoQi3ZOMi4NkYkpe1p4J7A8BpYAD49hfIy/oqG0+hLomiKP2L5L+1ubn5115S+3OAn4EnwBlgMzCjyt6ZAnQCJ4A7wOs88iRJHvw50HoujuPBoCKwHWiosy8MdfZnAdcHk8dxXFJ3VQbQlCTJvRBCGdRbD4M6uc5glpY3eAihpN5S5w12diSEcCCEcKUO4ljdr15T76ur1FDDLIQQ3qv71EdDOe3Kxj3leRXyk+pxdWnFWod6Wt2bY3de3aSuUHcPBVimHs7mK9WrmeOF6lR1o9qnzskh2ar2qm1qizpfXaPeVGdlmGN5pb09qMxz1Xb1kLqgzn1RyH7JUXW52lr5e/Kqi9qpto7V1atuUzfnARrV7jEib1T76gG2qxdGmXyiekkt1GswPTtek0aBfJp6YySGBfWg2tPQ0FAYgf1stUfdmdcjarbYJEniKIq6gY/Aw+zWHAC+p2labGpqiorFYgGYCEzN7oQdQClN07O1/EfDyGgC0ALMBdYAi4FyK+4H3gLPsxfR1zRNi+NP7nH5J+QntnXe5B5mpfQAAAAASUVORK5CYII=">

<!-- CSS -->
<link rel="stylesheet" type="text/css" href="nimdoc.out.css?v=2.3.1">

<!-- JS -->
<script type="text/javascript" src="dochack.js?v=2.3.1"></script>
</head>
<body>
  <div class="document" id="documentId">
    <div class="container">
      <h1 class="title">src/obiwan</h1>
      <div class="row">
  <div class="three columns">
    <div class="theme-select-wrapper">
      <label for="theme-select">Theme:&nbsp;</label>
      <select id="theme-select" onchange="setTheme(this.value)">
        <option value="auto">ðŸŒ— Match OS</option>
        <option value="dark">ðŸŒ‘ Dark</option>
        <option value="light">ðŸŒ• Light</option>
      </select>
    </div>
    <div id="global-links">
      <ul class="simple">
        <li><a id="indexLink" href="theindex.html">Index</a></li>
      </ul>
    </div>
    <div id="searchInputDiv">
      Search: <input type="search" id="searchInput" oninput="search()"/>
    </div>
    <div>
      Group by:
      <select onchange="groupBy(this.value)">
        <option value="section">Section</option>
        <option value="type">Type</option>
      </select>
    </div>
    <ul class="simple simple-toc" id="toc-list">
  <li>
  <a class="reference reference-toplevel" href="#6" id="56">Imports</a>
</li>
<li>
  <details open>
    <summary><a class="reference reference-toplevel" href="#7" id="57">Types</a></summary>
    <ul class="simple simple-toc-section">
      <li><a class="reference" href="#AsyncObiwanClient" title="AsyncObiwanClient = ObiwanClientBase[MbedtlsAsyncSocket]">AsyncObiwanClient</a></li>
<li><a class="reference" href="#AsyncObiwanServer" title="AsyncObiwanServer = ObiwanServerBase[MbedtlsAsyncSocket]">AsyncObiwanServer</a></li>
<li><a class="reference" href="#AsyncRequest" title="AsyncRequest = RequestBase[MbedtlsAsyncSocket]">AsyncRequest</a></li>
<li><a class="reference" href="#AsyncResponse" title="AsyncResponse = ResponseBase[AsyncObiwanClient]">AsyncResponse</a></li>
<li><a class="reference" href="#MbedtlsAsyncSocket" title="MbedtlsAsyncSocket = tlsAsyncSocket.MbedtlsAsyncSocket">MbedtlsAsyncSocket</a></li>
<li><a class="reference" href="#MbedtlsAsyncSocketObj" title="MbedtlsAsyncSocketObj = tlsAsyncSocket.MbedtlsAsyncSocketObj">MbedtlsAsyncSocketObj</a></li>
<li><a class="reference" href="#MbedtlsError" title="MbedtlsError = tlsSocket.MbedtlsError">MbedtlsError</a></li>
<li><a class="reference" href="#MbedtlsSocket" title="MbedtlsSocket = tlsSocket.MbedtlsSocket">MbedtlsSocket</a></li>
<li><a class="reference" href="#MbedtlsSocketObj" title="MbedtlsSocketObj = tlsSocket.MbedtlsSocketObj">MbedtlsSocketObj</a></li>
<li><a class="reference" href="#MbedtlsSslContext" title="MbedtlsSslContext = tlsSocket.MbedtlsSslContext">MbedtlsSslContext</a></li>
<li><a class="reference" href="#ObiwanClient" title="ObiwanClient = ObiwanClientBase[MbedtlsSocket]">ObiwanClient</a></li>
<li><a class="reference" href="#ObiwanServer" title="ObiwanServer = ObiwanServerBase[MbedtlsSocket]">ObiwanServer</a></li>
<li><a class="reference" href="#Request" title="Request = RequestBase[MbedtlsSocket]">Request</a></li>
<li><a class="reference" href="#Response" title="Response = ResponseBase[ObiwanClient]">Response</a></li>
<li><a class="reference" href="#SslContext" title="SslContext = tlsSocket.BaseSslContext">SslContext</a></li>
<li><a class="reference" href="#X509Certificate" title="X509Certificate = tlsSocket.X509Certificate">X509Certificate</a></li>

    </ul>
  </details>
</li>
<li>
  <details open>
    <summary><a class="reference reference-toplevel" href="#12" id="62">Procs</a></summary>
    <ul class="simple simple-toc-section">
      <ul class="simple nested-toc-section">body
  <li><a class="reference" href="#body%2CAsyncResponse" title="body(response: AsyncResponse): Future[string]">body(response: AsyncResponse): Future[string]</a></li>
<li><a class="reference" href="#body%2CResponse" title="body(response: Response): string">body(response: Response): string</a></li>

</ul>
<ul class="simple nested-toc-section">close
  <li><a class="reference" href="#close" title="close(client: ObiwanClient | AsyncObiwanClient)">close(client: ObiwanClient | AsyncObiwanClient)</a></li>

</ul>
<ul class="simple nested-toc-section">loadIdentityFile
  <li><a class="reference" href="#loadIdentityFile%2C%2Cstring%2Cstring" title="loadIdentityFile(client: ObiwanClient | AsyncObiwanClient;
                 certFile, keyFile: string): bool">loadIdentityFile(client: ObiwanClient | AsyncObiwanClient;
                 certFile, keyFile: string): bool</a></li>

</ul>
<ul class="simple nested-toc-section">newAsyncObiwanClient
  <li><a class="reference" href="#newAsyncObiwanClient%2Cint%2Cstring%2Cstring" title="newAsyncObiwanClient(maxRedirects = 5; certFile = &quot;&quot;; keyFile = &quot;&quot;): AsyncObiwanClient">newAsyncObiwanClient(maxRedirects = 5; certFile = &quot;&quot;; keyFile = &quot;&quot;): AsyncObiwanClient</a></li>

</ul>
<ul class="simple nested-toc-section">newAsyncObiwanServer
  <li><a class="reference" href="#newAsyncObiwanServer%2Cstring%2Cstring%2Cstring" title="newAsyncObiwanServer(reuseAddr = true; reusePort = false; certFile = &quot;&quot;;
                     keyFile = &quot;&quot;; sessionId = &quot;&quot;): AsyncObiwanServer">newAsyncObiwanServer(reuseAddr = true; reusePort = false; certFile = &quot;&quot;;
                     keyFile = &quot;&quot;; sessionId = &quot;&quot;): AsyncObiwanServer</a></li>

</ul>
<ul class="simple nested-toc-section">newObiwanClient
  <li><a class="reference" href="#newObiwanClient%2Cint%2Cstring%2Cstring" title="newObiwanClient(maxRedirects = 5; certFile = &quot;&quot;; keyFile = &quot;&quot;): ObiwanClient">newObiwanClient(maxRedirects = 5; certFile = &quot;&quot;; keyFile = &quot;&quot;): ObiwanClient</a></li>

</ul>
<ul class="simple nested-toc-section">newObiwanServer
  <li><a class="reference" href="#newObiwanServer%2Cstring%2Cstring%2Cstring" title="newObiwanServer(reuseAddr = true; reusePort = false; certFile = &quot;&quot;;
                keyFile = &quot;&quot;; sessionId = &quot;&quot;): ObiwanServer">newObiwanServer(reuseAddr = true; reusePort = false; certFile = &quot;&quot;;
                keyFile = &quot;&quot;; sessionId = &quot;&quot;): ObiwanServer</a></li>

</ul>
<ul class="simple nested-toc-section">request
  <li><a class="reference" href="#request%2CAsyncObiwanClient%2Cstring" title="request(client: AsyncObiwanClient; url: string): Future[AsyncResponse]">request(client: AsyncObiwanClient; url: string): Future[AsyncResponse]</a></li>
<li><a class="reference" href="#request%2CObiwanClient%2Cstring" title="request(client: ObiwanClient; url: string): Response">request(client: ObiwanClient; url: string): Response</a></li>

</ul>
<ul class="simple nested-toc-section">respond
  <li><a class="reference" href="#respond%2CAsyncRequest%2CStatus%2Cstring%2Cstring" title="respond(req: AsyncRequest; status: Status; meta: string; body: string = &quot;&quot;): owned(
    Future[void])">respond(req: AsyncRequest; status: Status; meta: string; body: string = &quot;&quot;): owned(
    Future[void])</a></li>
<li><a class="reference" href="#respond%2CRequest%2CStatus%2Cstring%2Cstring" title="respond(req: Request; status: Status; meta: string; body: string = &quot;&quot;)">respond(req: Request; status: Status; meta: string; body: string = &quot;&quot;)</a></li>

</ul>
<ul class="simple nested-toc-section">serve
  <li><a class="reference" href="#serve%2CAsyncObiwanServer%2Cint%2Cproc%28AsyncRequest%29%2Cstring" title="serve(server: AsyncObiwanServer; port: int;
      callback: proc (request: AsyncRequest): Future[void]; address = &quot;&quot;): Future[
    void]">serve(server: AsyncObiwanServer; port: int;
      callback: proc (request: AsyncRequest): Future[void]; address = &quot;&quot;): Future[
    void]</a></li>
<li><a class="reference" href="#serve%2CObiwanServer%2Cint%2Cproc%28Request%29%2Cstring" title="serve(server: ObiwanServer; port: int; callback: proc (request: Request);
      address = &quot;&quot;)">serve(server: ObiwanServer; port: int; callback: proc (request: Request);
      address = &quot;&quot;)</a></li>

</ul>

    </ul>
  </details>
</li>

</ul>

  </div>
  <div class="nine columns" id="content">
    
    <div id="tocRoot"></div>
    
    <p class="module-desc">ObiWAN Gemini protocol library</p>
    <div class="section" id="6">
  <h1><a class="toc-backref" href="#6">Imports</a></h1>
  <dl class="item">
    <a class="reference external" href="obiwan/url.html">obiwan/url</a>, <a class="reference external" href="obiwan/common.html">obiwan/common</a>, <a class="reference external" href="obiwan/debug.html">obiwan/debug</a>, <a class="reference external" href="obiwan/tls/mbedtls.html">obiwan/tls/mbedtls</a>, <a class="reference external" href="obiwan/tls/socket.html">obiwan/tls/socket</a>, <a class="reference external" href="obiwan/tls/async_socket.html">obiwan/tls/async_socket</a>, <a class="reference external" href="obiwan/config.html">obiwan/config</a>
  </dl>
</div>
<div class="section" id="7">
  <h1><a class="toc-backref" href="#7">Types</a></h1>
  <dl class="item">
    <div id="AsyncObiwanClient">
  <dt><pre><a href="obiwan.html#AsyncObiwanClient"><span class="Identifier">AsyncObiwanClient</span></a> <span class="Other">=</span> <a href="obiwan/common.html#ObiwanClientBase"><span class="Identifier">ObiwanClientBase</span></a><span class="Other">[</span><a href="obiwan.html#MbedtlsAsyncSocket"><span class="Identifier">MbedtlsAsyncSocket</span></a><span class="Other">]</span></pre></dt>
  <dd>
    
    Asynchronous Gemini protocol client. Use this type for non-blocking, asynchronous operations.
    
  </dd>
</div>
<div id="AsyncObiwanServer">
  <dt><pre><a href="obiwan.html#AsyncObiwanServer"><span class="Identifier">AsyncObiwanServer</span></a> <span class="Other">=</span> <a href="obiwan/common.html#ObiwanServerBase"><span class="Identifier">ObiwanServerBase</span></a><span class="Other">[</span><a href="obiwan.html#MbedtlsAsyncSocket"><span class="Identifier">MbedtlsAsyncSocket</span></a><span class="Other">]</span></pre></dt>
  <dd>
    
    Asynchronous Gemini protocol server. Use this type for non-blocking, asynchronous server implementations.
    
  </dd>
</div>
<div id="AsyncRequest">
  <dt><pre><a href="obiwan.html#AsyncRequest"><span class="Identifier">AsyncRequest</span></a> <span class="Other">=</span> <a href="obiwan/common.html#RequestBase"><span class="Identifier">RequestBase</span></a><span class="Other">[</span><a href="obiwan.html#MbedtlsAsyncSocket"><span class="Identifier">MbedtlsAsyncSocket</span></a><span class="Other">]</span></pre></dt>
  <dd>
    
    Asynchronous request received by a Gemini server. Contains URL, client certificate, and verification information.
    
  </dd>
</div>
<div id="AsyncResponse">
  <dt><pre><a href="obiwan.html#AsyncResponse"><span class="Identifier">AsyncResponse</span></a> <span class="Other">=</span> <a href="obiwan/common.html#ResponseBase"><span class="Identifier">ResponseBase</span></a><span class="Other">[</span><a href="obiwan.html#AsyncObiwanClient"><span class="Identifier">AsyncObiwanClient</span></a><span class="Other">]</span></pre></dt>
  <dd>
    
    Asynchronous response from a Gemini server. Contains status, meta information, and certificate details.
    
  </dd>
</div>
<div id="MbedtlsAsyncSocket">
  <dt><pre><a href="obiwan.html#MbedtlsAsyncSocket"><span class="Identifier">MbedtlsAsyncSocket</span></a> <span class="Other">=</span> <span class="Identifier">tlsAsyncSocket</span><span class="Other">.</span><span class="Identifier">MbedtlsAsyncSocket</span></pre></dt>
  <dd>
    
    Asynchronous TLS socket implementation using mbedTLS.
    
  </dd>
</div>
<div id="MbedtlsAsyncSocketObj">
  <dt><pre><a href="obiwan.html#MbedtlsAsyncSocketObj"><span class="Identifier">MbedtlsAsyncSocketObj</span></a> <span class="Other">=</span> <span class="Identifier">tlsAsyncSocket</span><span class="Other">.</span><span class="Identifier">MbedtlsAsyncSocketObj</span></pre></dt>
  <dd>
    
    Concrete object type for asynchronous TLS sockets.
    
  </dd>
</div>
<div id="MbedtlsError">
  <dt><pre><a href="obiwan.html#MbedtlsError"><span class="Identifier">MbedtlsError</span></a> <span class="Other">=</span> <span class="Identifier">tlsSocket</span><span class="Other">.</span><span class="Identifier">MbedtlsError</span></pre></dt>
  <dd>
    
    mbedTLS-specific error type.
    
  </dd>
</div>
<div id="MbedtlsSocket">
  <dt><pre><a href="obiwan.html#MbedtlsSocket"><span class="Identifier">MbedtlsSocket</span></a> <span class="Other">=</span> <span class="Identifier">tlsSocket</span><span class="Other">.</span><span class="Identifier">MbedtlsSocket</span></pre></dt>
  <dd>
    
    Synchronous TLS socket implementation using mbedTLS.
    
  </dd>
</div>
<div id="MbedtlsSocketObj">
  <dt><pre><a href="obiwan.html#MbedtlsSocketObj"><span class="Identifier">MbedtlsSocketObj</span></a> <span class="Other">=</span> <span class="Identifier">tlsSocket</span><span class="Other">.</span><span class="Identifier">MbedtlsSocketObj</span></pre></dt>
  <dd>
    
    Concrete object type for synchronous TLS sockets.
    
  </dd>
</div>
<div id="MbedtlsSslContext">
  <dt><pre><a href="obiwan.html#MbedtlsSslContext"><span class="Identifier">MbedtlsSslContext</span></a> <span class="Other">=</span> <span class="Identifier">tlsSocket</span><span class="Other">.</span><span class="Identifier">MbedtlsSslContext</span></pre></dt>
  <dd>
    
    Concrete SSL/TLS context implementation using mbedTLS.
    
  </dd>
</div>
<div id="ObiwanClient">
  <dt><pre><a href="obiwan.html#ObiwanClient"><span class="Identifier">ObiwanClient</span></a> <span class="Other">=</span> <a href="obiwan/common.html#ObiwanClientBase"><span class="Identifier">ObiwanClientBase</span></a><span class="Other">[</span><a href="obiwan.html#MbedtlsSocket"><span class="Identifier">MbedtlsSocket</span></a><span class="Other">]</span></pre></dt>
  <dd>
    
    Synchronous Gemini protocol client. Use this type for blocking, synchronous operations.
    
  </dd>
</div>
<div id="ObiwanServer">
  <dt><pre><a href="obiwan.html#ObiwanServer"><span class="Identifier">ObiwanServer</span></a> <span class="Other">=</span> <a href="obiwan/common.html#ObiwanServerBase"><span class="Identifier">ObiwanServerBase</span></a><span class="Other">[</span><a href="obiwan.html#MbedtlsSocket"><span class="Identifier">MbedtlsSocket</span></a><span class="Other">]</span></pre></dt>
  <dd>
    
    Synchronous Gemini protocol server. Use this type for blocking, synchronous server implementations.
    
  </dd>
</div>
<div id="Request">
  <dt><pre><a href="obiwan.html#Request"><span class="Identifier">Request</span></a> <span class="Other">=</span> <a href="obiwan/common.html#RequestBase"><span class="Identifier">RequestBase</span></a><span class="Other">[</span><a href="obiwan.html#MbedtlsSocket"><span class="Identifier">MbedtlsSocket</span></a><span class="Other">]</span></pre></dt>
  <dd>
    
    Synchronous request received by a Gemini server. Contains URL, client certificate, and verification information.
    
  </dd>
</div>
<div id="Response">
  <dt><pre><a href="obiwan.html#Response"><span class="Identifier">Response</span></a> <span class="Other">=</span> <a href="obiwan/common.html#ResponseBase"><span class="Identifier">ResponseBase</span></a><span class="Other">[</span><a href="obiwan.html#ObiwanClient"><span class="Identifier">ObiwanClient</span></a><span class="Other">]</span></pre></dt>
  <dd>
    
    Synchronous response from a Gemini server. Contains status, meta information, and certificate details.
    
  </dd>
</div>
<div id="SslContext">
  <dt><pre><a href="obiwan.html#SslContext"><span class="Identifier">SslContext</span></a> <span class="Other">=</span> <span class="Identifier">tlsSocket</span><span class="Other">.</span><span class="Identifier">BaseSslContext</span></pre></dt>
  <dd>
    
    Base SSL/TLS context type for both synchronous and asynchronous operations.
    
  </dd>
</div>
<div id="X509Certificate">
  <dt><pre><a href="obiwan.html#X509Certificate"><span class="Identifier">X509Certificate</span></a> <span class="Other">=</span> <span class="Identifier">tlsSocket</span><span class="Other">.</span><span class="Identifier">X509Certificate</span></pre></dt>
  <dd>
    
    X.509 certificate type for TLS encryption and authentication.
    
  </dd>
</div>

  </dl>
</div>
<div class="section" id="12">
  <h1><a class="toc-backref" href="#12">Procs</a></h1>
  <dl class="item">
    <div id="body-procs-all">
  <div id="body,AsyncResponse">
  <dt><pre><span class="Keyword">proc</span> <a href="#body%2CAsyncResponse"><span class="Identifier">body</span></a><span class="Other">(</span><span class="Identifier">response</span><span class="Other">:</span> <a href="obiwan.html#AsyncResponse"><span class="Identifier">AsyncResponse</span></a><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">Future</span><span class="Other">[</span><span class="Identifier">string</span><span class="Other">]</span> {.<span><span class="Other pragmadots">...</span></span><span class="pragmawrap"><span class="Identifier">stackTrace</span><span class="Other">:</span> <span class="DecNumber">false</span><span class="Other">,</span>
    <span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Identifier">Exception</span><span class="Other">,</span> <span class="Identifier">ValueError</span><span class="Other">,</span> <span class="Identifier">OSError</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Identifier">RootEffect</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">forbids</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span>.}</pre></dt>
  <dd>
    
    <p>Retrieves the body content associated with a successful response.</p>
<p>This function reads the response body content from the server and returns it as a string. The connection to the server is automatically closed once the entire body has been retrieved. This should only be called on responses with Status.Success (20), as other status codes won't have a body to retrieve.</p>
<p>Parameters: response: The Response or AsyncResponse from a previous request call</p>
<p>Returns: The complete body content as a string</p>
<p>Raises: Various network-related exceptions may be raised during body retrieval</p>
<p>Note:</p>
<ul class="simple"><li>For synchronous clients, this blocks until the entire body is received</li>
<li>For asynchronous clients, this returns a Future that completes when the body is fully received</li>
</ul>
<p>Example:</p>
<p><pre class="listing"><span class="Comment"># Synchronous example</span>
<span class="Keyword">let</span> <span class="Identifier">response</span> <span class="Operator">=</span> <span class="Identifier">client</span><span class="Operator">.</span><span class="Identifier">request</span><span class="Punctuation">(</span><span class="StringLit">&quot;gemini://example.com/&quot;</span><span class="Punctuation">)</span>
<span class="Keyword">if</span> <span class="Identifier">response</span><span class="Operator">.</span><span class="Identifier">status</span> <span class="Operator">==</span> <span class="Identifier">Status</span><span class="Operator">.</span><span class="Identifier">Success</span><span class="Punctuation">:</span>
  <span class="Keyword">let</span> <span class="Identifier">content</span> <span class="Operator">=</span> <span class="Identifier">response</span><span class="Operator">.</span><span class="Identifier">body</span><span class="Punctuation">(</span><span class="Punctuation">)</span>
  <span class="Identifier">echo</span> <span class="Identifier">content</span>

<span class="Comment"># Asynchronous example</span>
<span class="Keyword">let</span> <span class="Identifier">response</span> <span class="Operator">=</span> <span class="Identifier">await</span> <span class="Identifier">client</span><span class="Operator">.</span><span class="Identifier">request</span><span class="Punctuation">(</span><span class="StringLit">&quot;gemini://example.com/&quot;</span><span class="Punctuation">)</span>
<span class="Keyword">if</span> <span class="Identifier">response</span><span class="Operator">.</span><span class="Identifier">status</span> <span class="Operator">==</span> <span class="Identifier">Status</span><span class="Operator">.</span><span class="Identifier">Success</span><span class="Punctuation">:</span>
  <span class="Keyword">let</span> <span class="Identifier">content</span> <span class="Operator">=</span> <span class="Identifier">await</span> <span class="Identifier">response</span><span class="Operator">.</span><span class="Identifier">body</span><span class="Punctuation">(</span><span class="Punctuation">)</span>
  <span class="Identifier">echo</span> <span class="Identifier">content</span></pre></p>

    
  </dd>
</div>
<div id="body,Response">
  <dt><pre><span class="Keyword">proc</span> <a href="#body%2CResponse"><span class="Identifier">body</span></a><span class="Other">(</span><span class="Identifier">response</span><span class="Other">:</span> <a href="obiwan.html#Response"><span class="Identifier">Response</span></a><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">string</span> {.<span><span class="Other pragmadots">...</span></span><span class="pragmawrap"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Identifier">MbedtlsError</span><span class="Other">,</span> <span class="Identifier">IOError</span><span class="Other">,</span> <span class="Identifier">OSError</span><span class="Other">]</span><span class="Other">,</span>
                                        <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Identifier">WriteIOEffect</span><span class="Other">,</span> <span class="Identifier">ReadIOEffect</span><span class="Other">]</span><span class="Other">,</span>
                                        <span class="Identifier">forbids</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span>.}</pre></dt>
  <dd>
    
    
    
  </dd>
</div>

</div>
<div id="close-procs-all">
  <div id="close">
  <dt><pre><span class="Keyword">proc</span> <a href="#close"><span class="Identifier">close</span></a><span class="Other">(</span><span class="Identifier">client</span><span class="Other">:</span> <a href="obiwan.html#ObiwanClient"><span class="Identifier">ObiwanClient</span></a> <span class="Operator">|</span> <a href="obiwan.html#AsyncObiwanClient"><span class="Identifier">AsyncObiwanClient</span></a><span class="Other">)</span></pre></dt>
  <dd>
    
    <p>Manually closes the client's connection to the server.</p>
<p>This function explicitly closes the TLS socket connection to the server. Normally, this is handled automatically by the body() method, but you can use this method to close the connection early or if you don't need to retrieve the body content.</p>
<p>Parameters: client: The ObiwanClient or AsyncObiwanClient whose connection to close</p>
<p>Example:</p>
<p><pre class="listing"><span class="Keyword">let</span> <span class="Identifier">client</span> <span class="Operator">=</span> <span class="Identifier">newObiwanClient</span><span class="Punctuation">(</span><span class="Punctuation">)</span>
<span class="Keyword">let</span> <span class="Identifier">response</span> <span class="Operator">=</span> <span class="Identifier">client</span><span class="Operator">.</span><span class="Identifier">request</span><span class="Punctuation">(</span><span class="StringLit">&quot;gemini://example.com/&quot;</span><span class="Punctuation">)</span>
<span class="Comment"># Close without reading the body</span>
<span class="Identifier">client</span><span class="Operator">.</span><span class="Identifier">close</span><span class="Punctuation">(</span><span class="Punctuation">)</span></pre></p>

    
  </dd>
</div>

</div>
<div id="loadIdentityFile-procs-all">
  <div id="loadIdentityFile,,string,string">
  <dt><pre><span class="Keyword">proc</span> <a href="#loadIdentityFile%2C%2Cstring%2Cstring"><span class="Identifier">loadIdentityFile</span></a><span class="Other">(</span><span class="Identifier">client</span><span class="Other">:</span> <a href="obiwan.html#ObiwanClient"><span class="Identifier">ObiwanClient</span></a> <span class="Operator">|</span> <a href="obiwan.html#AsyncObiwanClient"><span class="Identifier">AsyncObiwanClient</span></a><span class="Other">;</span>
                      <span class="Identifier">certFile</span><span class="Other">,</span> <span class="Identifier">keyFile</span><span class="Other">:</span> <span class="Identifier">string</span><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">bool</span></pre></dt>
  <dd>
    
    <p>Loads a client certificate and private key from PEM files for client authentication.</p>
<p>This allows the client to offer a certificate to the server when connecting, which is used for client authentication in the Gemini protocol. The server may require a certificate for certain resources (indicated by status codes 60-62).</p>
<p>Parameters: client: The ObiwanClient or AsyncObiwanClient instance certFile: Path to the certificate file in PEM format keyFile: Path to the private key file in PEM format</p>
<p>Returns: <tt class="docutils literal"><span class="pre"><span class="Identifier">true</span></span></tt> if the certificate and key were loaded successfully, <tt class="docutils literal"><span class="pre"><span class="Identifier">false</span></span></tt> otherwise</p>
<p>Raises: No exceptions are raised; errors are reported via the return value.</p>

    
  </dd>
</div>

</div>
<div id="newAsyncObiwanClient-procs-all">
  <div id="newAsyncObiwanClient,int,string,string">
  <dt><pre><span class="Keyword">proc</span> <a href="#newAsyncObiwanClient%2Cint%2Cstring%2Cstring"><span class="Identifier">newAsyncObiwanClient</span></a><span class="Other">(</span><span class="Identifier">maxRedirects</span> <span class="Other">=</span> <span class="DecNumber">5</span><span class="Other">;</span> <span class="Identifier">certFile</span> <span class="Other">=</span> <span class="StringLit">&quot;&quot;</span><span class="Other">;</span> <span class="Identifier">keyFile</span> <span class="Other">=</span> <span class="StringLit">&quot;&quot;</span><span class="Other">)</span><span class="Other">:</span> <a href="obiwan.html#AsyncObiwanClient"><span class="Identifier">AsyncObiwanClient</span></a> {.
    <span><span class="Other pragmadots">...</span></span><span class="pragmawrap"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Identifier">MbedtlsError</span><span class="Other">,</span> <span class="Identifier">ObiwanError</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Identifier">ReadDirEffect</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">forbids</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span>.}</pre></dt>
  <dd>
    
    <p>Creates a new asynchronous Gemini protocol client.</p>
<p>This function creates an asynchronous client for making non-blocking Gemini protocol requests. The client handles TLS connections with proper certificate verification for the Gemini protocol's security model, which includes support for self-signed certificates.</p>
<p>Parameters: maxRedirects: Maximum number of redirects to follow automatically (default: 5) certFile: Optional path to client certificate file in PEM format (for client authentication) keyFile: Optional path to client private key file in PEM format (for client authentication)</p>
<p>Returns: A new AsyncObiwanClient instance ready for making async requests</p>
<p>Raises: ObiwanError: If certificate files are specified but cannot be loaded</p>
<p>Example:</p>
<p><pre class="listing"><span class="Keyword">proc</span> <span class="Identifier">main</span><span class="Punctuation">(</span><span class="Punctuation">)</span> <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">async</span><span class="Operator">.</span><span class="Punctuation">}</span> <span class="Operator">=</span>
  <span class="Keyword">let</span> <span class="Identifier">client</span> <span class="Operator">=</span> <span class="Identifier">newAsyncObiwanClient</span><span class="Punctuation">(</span><span class="Punctuation">)</span>
  <span class="Keyword">let</span> <span class="Identifier">response</span> <span class="Operator">=</span> <span class="Identifier">await</span> <span class="Identifier">client</span><span class="Operator">.</span><span class="Identifier">request</span><span class="Punctuation">(</span><span class="StringLit">&quot;gemini://example.com/&quot;</span><span class="Punctuation">)</span>
  <span class="Keyword">if</span> <span class="Identifier">response</span><span class="Operator">.</span><span class="Identifier">status</span> <span class="Operator">==</span> <span class="Identifier">Status</span><span class="Operator">.</span><span class="Identifier">Success</span><span class="Punctuation">:</span>
    <span class="Keyword">let</span> <span class="Identifier">content</span> <span class="Operator">=</span> <span class="Identifier">await</span> <span class="Identifier">response</span><span class="Operator">.</span><span class="Identifier">body</span><span class="Punctuation">(</span><span class="Punctuation">)</span>
    <span class="Identifier">echo</span> <span class="Identifier">content</span>

<span class="Identifier">waitFor</span> <span class="Identifier">main</span><span class="Punctuation">(</span><span class="Punctuation">)</span></pre></p>

    
  </dd>
</div>

</div>
<div id="newAsyncObiwanServer-procs-all">
  <div id="newAsyncObiwanServer,string,string,string">
  <dt><pre><span class="Keyword">proc</span> <a href="#newAsyncObiwanServer%2Cstring%2Cstring%2Cstring"><span class="Identifier">newAsyncObiwanServer</span></a><span class="Other">(</span><span class="Identifier">reuseAddr</span> <span class="Other">=</span> <span class="Identifier">true</span><span class="Other">;</span> <span class="Identifier">reusePort</span> <span class="Other">=</span> <span class="Identifier">false</span><span class="Other">;</span> <span class="Identifier">certFile</span> <span class="Other">=</span> <span class="StringLit">&quot;&quot;</span><span class="Other">;</span>
                          <span class="Identifier">keyFile</span> <span class="Other">=</span> <span class="StringLit">&quot;&quot;</span><span class="Other">;</span> <span class="Identifier">sessionId</span> <span class="Other">=</span> <span class="StringLit">&quot;&quot;</span><span class="Other">)</span><span class="Other">:</span> <a href="obiwan.html#AsyncObiwanServer"><span class="Identifier">AsyncObiwanServer</span></a> {.
    <span><span class="Other pragmadots">...</span></span><span class="pragmawrap"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Identifier">MbedtlsError</span><span class="Other">,</span> <span class="Identifier">ObiwanError</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">forbids</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span>.}</pre></dt>
  <dd>
    
    <p>Creates a new asynchronous Gemini protocol server.</p>
<p>This function creates an asynchronous server for handling Gemini protocol requests without blocking the main thread. A TLS certificate and private key are required for the server to function, as the Gemini protocol mandates secure connections.</p>
<p>The server supports optional client certificate verification, which can be used to implement authentication. Client certificates are made available to request handlers through the AsyncRequest.certificate property.</p>
<p>Parameters: reuseAddr: Allow reusing local addresses (default: true) reusePort: Allow multiple bindings to same port (default: false) certFile: Path to server certificate file in PEM format (required for production) keyFile: Path to server private key file in PEM format (required for production) sessionId: Optional custom session ID for TLS session resumption</p>
<p>Returns: A new AsyncObiwanServer instance that can be used with serve()</p>
<p>Raises: ObiwanError: If certificate or key files cannot be loaded</p>
<p>Note: If sessionId is not provided, a random one will be generated. For testing, you can omit certFile and keyFile, but for production use, valid certificate and key files are required.</p>

    
  </dd>
</div>

</div>
<div id="newObiwanClient-procs-all">
  <div id="newObiwanClient,int,string,string">
  <dt><pre><span class="Keyword">proc</span> <a href="#newObiwanClient%2Cint%2Cstring%2Cstring"><span class="Identifier">newObiwanClient</span></a><span class="Other">(</span><span class="Identifier">maxRedirects</span> <span class="Other">=</span> <span class="DecNumber">5</span><span class="Other">;</span> <span class="Identifier">certFile</span> <span class="Other">=</span> <span class="StringLit">&quot;&quot;</span><span class="Other">;</span> <span class="Identifier">keyFile</span> <span class="Other">=</span> <span class="StringLit">&quot;&quot;</span><span class="Other">)</span><span class="Other">:</span> <a href="obiwan.html#ObiwanClient"><span class="Identifier">ObiwanClient</span></a> {.
    <span><span class="Other pragmadots">...</span></span><span class="pragmawrap"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Identifier">MbedtlsError</span><span class="Other">,</span> <span class="Identifier">ObiwanError</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Identifier">ReadDirEffect</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">forbids</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span>.}</pre></dt>
  <dd>
    
    <p>Creates a new synchronous Gemini protocol client.</p>
<p>This function creates a synchronous client for making Gemini protocol requests. The client handles TLS connections with proper certificate verification for the Gemini protocol's security model, which includes support for self-signed certificates.</p>
<p>Parameters: maxRedirects: Maximum number of redirects to follow automatically (default: 5) certFile: Optional path to client certificate file in PEM format (for client authentication) keyFile: Optional path to client private key file in PEM format (for client authentication)</p>
<p>Returns: A new ObiwanClient instance ready for making requests</p>
<p>Raises: ObiwanError: If certificate files are specified but cannot be loaded</p>
<p>Example:</p>
<p><pre class="listing"><span class="Keyword">let</span> <span class="Identifier">client</span> <span class="Operator">=</span> <span class="Identifier">newObiwanClient</span><span class="Punctuation">(</span><span class="Punctuation">)</span>
<span class="Keyword">let</span> <span class="Identifier">response</span> <span class="Operator">=</span> <span class="Identifier">client</span><span class="Operator">.</span><span class="Identifier">request</span><span class="Punctuation">(</span><span class="StringLit">&quot;gemini://example.com/&quot;</span><span class="Punctuation">)</span>
<span class="Keyword">if</span> <span class="Identifier">response</span><span class="Operator">.</span><span class="Identifier">status</span> <span class="Operator">==</span> <span class="Identifier">Status</span><span class="Operator">.</span><span class="Identifier">Success</span><span class="Punctuation">:</span>
  <span class="Keyword">let</span> <span class="Identifier">content</span> <span class="Operator">=</span> <span class="Identifier">response</span><span class="Operator">.</span><span class="Identifier">body</span><span class="Punctuation">(</span><span class="Punctuation">)</span>
  <span class="Identifier">echo</span> <span class="Identifier">content</span></pre></p>

    
  </dd>
</div>

</div>
<div id="newObiwanServer-procs-all">
  <div id="newObiwanServer,string,string,string">
  <dt><pre><span class="Keyword">proc</span> <a href="#newObiwanServer%2Cstring%2Cstring%2Cstring"><span class="Identifier">newObiwanServer</span></a><span class="Other">(</span><span class="Identifier">reuseAddr</span> <span class="Other">=</span> <span class="Identifier">true</span><span class="Other">;</span> <span class="Identifier">reusePort</span> <span class="Other">=</span> <span class="Identifier">false</span><span class="Other">;</span> <span class="Identifier">certFile</span> <span class="Other">=</span> <span class="StringLit">&quot;&quot;</span><span class="Other">;</span>
                     <span class="Identifier">keyFile</span> <span class="Other">=</span> <span class="StringLit">&quot;&quot;</span><span class="Other">;</span> <span class="Identifier">sessionId</span> <span class="Other">=</span> <span class="StringLit">&quot;&quot;</span><span class="Other">)</span><span class="Other">:</span> <a href="obiwan.html#ObiwanServer"><span class="Identifier">ObiwanServer</span></a> {.
    <span><span class="Other pragmadots">...</span></span><span class="pragmawrap"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Identifier">MbedtlsError</span><span class="Other">,</span> <span class="Identifier">ObiwanError</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">forbids</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span>.}</pre></dt>
  <dd>
    
    <p>Creates a new synchronous Gemini protocol server.</p>
<p>This function creates a synchronous server for handling Gemini protocol requests. A TLS certificate and private key are required for the server to function, as the Gemini protocol mandates secure connections.</p>
<p>The server supports optional client certificate verification, which can be used to implement authentication. Client certificates are made available to request handlers through the Request.certificate property.</p>
<p>Parameters: reuseAddr: Allow reusing local addresses (default: true) reusePort: Allow multiple bindings to same port (default: false) certFile: Path to server certificate file in PEM format (required for production) keyFile: Path to server private key file in PEM format (required for production) sessionId: Optional custom session ID for TLS session resumption</p>
<p>Returns: A new ObiwanServer instance that can be used with serve()</p>
<p>Raises: ObiwanError: If certificate or key files cannot be loaded</p>
<p>Note: If sessionId is not provided, a random one will be generated. For testing, you can omit certFile and keyFile, but for production use, valid certificate and key files are required.</p>

    
  </dd>
</div>

</div>
<div id="request-procs-all">
  <div id="request,AsyncObiwanClient,string">
  <dt><pre><span class="Keyword">proc</span> <a href="#request%2CAsyncObiwanClient%2Cstring"><span class="Identifier">request</span></a><span class="Other">(</span><span class="Identifier">client</span><span class="Other">:</span> <a href="obiwan.html#AsyncObiwanClient"><span class="Identifier">AsyncObiwanClient</span></a><span class="Other">;</span> <span class="Identifier">url</span><span class="Other">:</span> <span class="Identifier">string</span><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">Future</span><span class="Other">[</span><a href="obiwan.html#AsyncResponse"><span class="Identifier">AsyncResponse</span></a><span class="Other">]</span> {.
    <span><span class="Other pragmadots">...</span></span><span class="pragmawrap"><span class="Identifier">stackTrace</span><span class="Other">:</span> <span class="DecNumber">false</span><span class="Other">,</span> <span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Identifier">Exception</span><span class="Other">,</span> <span class="Identifier">ValueError</span><span class="Other">,</span> <span class="Identifier">CatchableError</span><span class="Other">,</span>
                                <span class="Identifier">ObiwanError</span><span class="Other">,</span> <span class="Identifier">OSError</span><span class="Other">,</span> <span class="Identifier">EOFError</span><span class="Other">]</span><span class="Other">,</span>
    <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Identifier">RootEffect</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">forbids</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span>.}</pre></dt>
  <dd>
    
    <p>Makes a Gemini protocol request to the specified URL and returns the response.</p>
<p>This function handles the entire request process, including:</p>
<ul class="simple"><li>Establishing TLS connection to the server</li>
<li>Sending the URL request</li>
<li>Parsing the server's response status and meta information</li>
<li>Obtaining the server's certificate and verification status</li>
<li>Automatically following redirects up to client.maxRedirects</li>
</ul>
<p>The connection remains open if the request was successful (Status.Success), allowing the body content to be retrieved separately using the response.body() method. For other status codes, the connection is closed automatically.</p>
<p>Parameters: client: The ObiwanClient or AsyncObiwanClient to use for the request url: The Gemini URL to request (must use gemini:// scheme)</p>
<p>Returns: A Response or AsyncResponse object containing status, meta, and certificate information</p>
<p>Raises: ObiwanError: For network errors, malformed responses, invalid URLs, or too many redirects</p>
<p>Example:</p>
<p><pre class="listing"><span class="Comment"># Synchronous example</span>
<span class="Keyword">let</span> <span class="Identifier">client</span> <span class="Operator">=</span> <span class="Identifier">newObiwanClient</span><span class="Punctuation">(</span><span class="Punctuation">)</span>
<span class="Keyword">let</span> <span class="Identifier">response</span> <span class="Operator">=</span> <span class="Identifier">client</span><span class="Operator">.</span><span class="Identifier">request</span><span class="Punctuation">(</span><span class="StringLit">&quot;gemini://example.com/&quot;</span><span class="Punctuation">)</span>

<span class="Comment"># Asynchronous example</span>
<span class="Keyword">let</span> <span class="Identifier">client</span> <span class="Operator">=</span> <span class="Identifier">newAsyncObiwanClient</span><span class="Punctuation">(</span><span class="Punctuation">)</span>
<span class="Keyword">let</span> <span class="Identifier">response</span> <span class="Operator">=</span> <span class="Identifier">await</span> <span class="Identifier">client</span><span class="Operator">.</span><span class="Identifier">request</span><span class="Punctuation">(</span><span class="StringLit">&quot;gemini://example.com/&quot;</span><span class="Punctuation">)</span></pre></p>

    
  </dd>
</div>
<div id="request,ObiwanClient,string">
  <dt><pre><span class="Keyword">proc</span> <a href="#request%2CObiwanClient%2Cstring"><span class="Identifier">request</span></a><span class="Other">(</span><span class="Identifier">client</span><span class="Other">:</span> <a href="obiwan.html#ObiwanClient"><span class="Identifier">ObiwanClient</span></a><span class="Other">;</span> <span class="Identifier">url</span><span class="Other">:</span> <span class="Identifier">string</span><span class="Other">)</span><span class="Other">:</span> <a href="obiwan.html#Response"><span class="Identifier">Response</span></a> {.
    <span><span class="Other pragmadots">...</span></span><span class="pragmawrap"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Identifier">CatchableError</span><span class="Other">,</span> <span class="Identifier">ValueError</span><span class="Other">,</span> <span class="Identifier">ObiwanError</span><span class="Other">,</span> <span class="Identifier">MbedtlsError</span><span class="Other">,</span> <span class="Identifier">Exception</span><span class="Other">]</span><span class="Other">,</span>
    <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Identifier">RootEffect</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">forbids</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span>.}</pre></dt>
  <dd>
    
    
    
  </dd>
</div>

</div>
<div id="respond-procs-all">
  <div id="respond,AsyncRequest,Status,string,string">
  <dt><pre><span class="Keyword">proc</span> <a href="#respond%2CAsyncRequest%2CStatus%2Cstring%2Cstring"><span class="Identifier">respond</span></a><span class="Other">(</span><span class="Identifier">req</span><span class="Other">:</span> <a href="obiwan.html#AsyncRequest"><span class="Identifier">AsyncRequest</span></a><span class="Other">;</span> <span class="Identifier">status</span><span class="Other">:</span> <a href="obiwan/common.html#Status"><span class="Identifier">Status</span></a><span class="Other">;</span> <span class="Identifier">meta</span><span class="Other">:</span> <span class="Identifier">string</span><span class="Other">;</span> <span class="Identifier">body</span><span class="Other">:</span> <span class="Identifier">string</span> <span class="Other">=</span> <span class="StringLit">&quot;&quot;</span><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">owned</span><span class="Other">(</span>
    <span class="Identifier">Future</span><span class="Other">[</span><span class="Identifier">void</span><span class="Other">]</span><span class="Other">)</span> {.<span><span class="Other pragmadots">...</span></span><span class="pragmawrap"><span class="Identifier">stackTrace</span><span class="Other">:</span> <span class="DecNumber">false</span><span class="Other">,</span> <span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Identifier">Exception</span><span class="Other">,</span> <span class="Identifier">OSError</span><span class="Other">,</span> <span class="Identifier">ValueError</span><span class="Other">]</span><span class="Other">,</span>
                    <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Identifier">RootEffect</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">forbids</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span>.}</pre></dt>
  <dd>
    
    <p>Sends a response to a client according to the Gemini protocol specification.</p>
<p>This function constructs and sends a properly formatted Gemini response, consisting of:</p>
<ul class="simple"><li>A status code (from the Status enum)</li>
<li>A meta string (whose meaning depends on the status code)</li>
<li>An optional body (only sent for Status.Success responses)</li>
</ul>
<p>The meta string's interpretation depends on the status code category:</p>
<ul class="simple"><li>1x (Input): A prompt for user input</li>
<li>2x (Success): A MIME type for the content (e.g., &quot;text/gemini&quot;)</li>
<li>3x (Redirect): A target URL</li>
<li>4x/5x (Error): An error message</li>
<li>6x (Client Certificate): Information about certificate requirements</li>
</ul>
<p>Parameters: req: The Request or AsyncRequest to respond to status: The status code to send (see Status enum) meta: The meta information string (max 1024 characters) body: Optional body content (only sent for Status.Success)</p>
<p>Raises: AssertionDefect: If meta exceeds 1024 characters Various exceptions may be caught internally and result in an error response</p>
<p>Example:</p>
<p><pre class="listing"><span class="Comment"># Success response with content</span>
<span class="Identifier">req</span><span class="Operator">.</span><span class="Identifier">respond</span><span class="Punctuation">(</span><span class="Identifier">Status</span><span class="Operator">.</span><span class="Identifier">Success</span><span class="Punctuation">,</span> <span class="StringLit">&quot;text/gemini&quot;</span><span class="Punctuation">,</span> <span class="StringLit">&quot;# Welcome to my Gemini server</span><span class="EscapeSequence">\n</span><span class="EscapeSequence">\n</span><span class="StringLit">Hello world!&quot;</span><span class="Punctuation">)</span>

<span class="Comment"># Not found error</span>
<span class="Identifier">req</span><span class="Operator">.</span><span class="Identifier">respond</span><span class="Punctuation">(</span><span class="Identifier">Status</span><span class="Operator">.</span><span class="Identifier">NotFound</span><span class="Punctuation">,</span> <span class="StringLit">&quot;Resource not available&quot;</span><span class="Punctuation">)</span>

<span class="Comment"># Redirect</span>
<span class="Identifier">req</span><span class="Operator">.</span><span class="Identifier">respond</span><span class="Punctuation">(</span><span class="Identifier">Status</span><span class="Operator">.</span><span class="Identifier">Redirect</span><span class="Punctuation">,</span> <span class="StringLit">&quot;gemini://example.com/new-location&quot;</span><span class="Punctuation">)</span></pre></p>

    
  </dd>
</div>
<div id="respond,Request,Status,string,string">
  <dt><pre><span class="Keyword">proc</span> <a href="#respond%2CRequest%2CStatus%2Cstring%2Cstring"><span class="Identifier">respond</span></a><span class="Other">(</span><span class="Identifier">req</span><span class="Other">:</span> <a href="obiwan.html#Request"><span class="Identifier">Request</span></a><span class="Other">;</span> <span class="Identifier">status</span><span class="Other">:</span> <a href="obiwan/common.html#Status"><span class="Identifier">Status</span></a><span class="Other">;</span> <span class="Identifier">meta</span><span class="Other">:</span> <span class="Identifier">string</span><span class="Other">;</span> <span class="Identifier">body</span><span class="Other">:</span> <span class="Identifier">string</span> <span class="Other">=</span> <span class="StringLit">&quot;&quot;</span><span class="Other">)</span> {.
    <span><span class="Other pragmadots">...</span></span><span class="pragmawrap"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Identifier">MbedtlsError</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">forbids</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span>.}</pre></dt>
  <dd>
    
    
    
  </dd>
</div>

</div>
<div id="serve-procs-all">
  <div id="serve,AsyncObiwanServer,int,proc(AsyncRequest),string">
  <dt><pre><span class="Keyword">proc</span> <a href="#serve%2CAsyncObiwanServer%2Cint%2Cproc%28AsyncRequest%29%2Cstring"><span class="Identifier">serve</span></a><span class="Other">(</span><span class="Identifier">server</span><span class="Other">:</span> <a href="obiwan.html#AsyncObiwanServer"><span class="Identifier">AsyncObiwanServer</span></a><span class="Other">;</span> <span class="Identifier">port</span><span class="Other">:</span> <span class="Identifier">int</span><span class="Other">;</span>
           <span class="Identifier">callback</span><span class="Other">:</span> <span class="Keyword">proc</span> <span class="Other">(</span><span class="Identifier">request</span><span class="Other">:</span> <a href="obiwan.html#AsyncRequest"><span class="Identifier">AsyncRequest</span></a><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">Future</span><span class="Other">[</span><span class="Identifier">void</span><span class="Other">]</span><span class="Other">;</span> <span class="Identifier">address</span> <span class="Other">=</span> <span class="StringLit">&quot;&quot;</span><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">Future</span><span class="Other">[</span>
    <span class="Identifier">void</span><span class="Other">]</span> {.<span><span class="Other pragmadots">...</span></span><span class="pragmawrap"><span class="Identifier">stackTrace</span><span class="Other">:</span> <span class="DecNumber">false</span><span class="Other">,</span> <span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Identifier">Exception</span><span class="Other">,</span> <span class="Identifier">OSError</span><span class="Other">,</span> <span class="Identifier">ValueError</span><span class="Other">]</span><span class="Other">,</span>
            <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Identifier">RootEffect</span><span class="Other">,</span> <span class="Identifier">WriteIOEffect</span><span class="Other">,</span> <span class="Identifier">ReadIOEffect</span><span class="Other">,</span> <span class="Identifier">TimeEffect</span><span class="Other">]</span><span class="Other">,</span>
            <span class="Identifier">forbids</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span>.}</pre></dt>
  <dd>
    
    <p>Starts an asynchronous Gemini protocol server on the specified port.</p>
<p>This function starts an asynchronous server that listens for incoming Gemini protocol requests without blocking the main thread. For each connection, it handles the TLS handshake, reads the request, and calls the provided async callback function with an AsyncRequest object. The callback is responsible for calling respond() to send a response.</p>
<p>Although this function runs asynchronously, it still runs indefinitely until the Future is cancelled or the process is terminated.</p>
<p>Parameters: server: The AsyncObiwanServer instance created with newAsyncObiwanServer() port: The port to listen on (standard Gemini port is 1965) callback: An async procedure to call for each received request address: Optional IP address to bind to (default: &quot;0.0.0.0&quot;). Use &quot;::&quot; for IPv6 with possible dual-stack support (IPv4+IPv6) if supported by the operating system.</p>
<p>Returns: A Future that completes when the server stops running (which is normally never)</p>
<p>Example:</p>
<p><pre class="listing"><span class="Keyword">proc</span> <span class="Identifier">handleRequest</span><span class="Punctuation">(</span><span class="Identifier">req</span><span class="Punctuation">:</span> <span class="Identifier">AsyncRequest</span><span class="Punctuation">)</span> <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">async</span><span class="Operator">.</span><span class="Punctuation">}</span> <span class="Operator">=</span>
  <span class="Identifier">req</span><span class="Operator">.</span><span class="Identifier">respond</span><span class="Punctuation">(</span><span class="Identifier">Status</span><span class="Operator">.</span><span class="Identifier">Success</span><span class="Punctuation">,</span> <span class="StringLit">&quot;text/gemini&quot;</span><span class="Punctuation">,</span> <span class="StringLit">&quot;# Hello from my async Gemini server!&quot;</span><span class="Punctuation">)</span>

<span class="Keyword">proc</span> <span class="Identifier">main</span><span class="Punctuation">(</span><span class="Punctuation">)</span> <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">async</span><span class="Operator">.</span><span class="Punctuation">}</span> <span class="Operator">=</span>
  <span class="Keyword">let</span> <span class="Identifier">server</span> <span class="Operator">=</span> <span class="Identifier">newAsyncObiwanServer</span><span class="Punctuation">(</span><span class="Identifier">certFile</span><span class="Operator">=</span><span class="StringLit">&quot;server.crt&quot;</span><span class="Punctuation">,</span> <span class="Identifier">keyFile</span><span class="Operator">=</span><span class="StringLit">&quot;server.key&quot;</span><span class="Punctuation">)</span>
  <span class="Identifier">await</span> <span class="Identifier">server</span><span class="Operator">.</span><span class="Identifier">serve</span><span class="Punctuation">(</span><span class="DecNumber">1965</span><span class="Punctuation">,</span> <span class="Identifier">handleRequest</span><span class="Punctuation">)</span>

<span class="Identifier">waitFor</span> <span class="Identifier">main</span><span class="Punctuation">(</span><span class="Punctuation">)</span></pre></p>

    
  </dd>
</div>
<div id="serve,ObiwanServer,int,proc(Request),string">
  <dt><pre><span class="Keyword">proc</span> <a href="#serve%2CObiwanServer%2Cint%2Cproc%28Request%29%2Cstring"><span class="Identifier">serve</span></a><span class="Other">(</span><span class="Identifier">server</span><span class="Other">:</span> <a href="obiwan.html#ObiwanServer"><span class="Identifier">ObiwanServer</span></a><span class="Other">;</span> <span class="Identifier">port</span><span class="Other">:</span> <span class="Identifier">int</span><span class="Other">;</span> <span class="Identifier">callback</span><span class="Other">:</span> <span class="Keyword">proc</span> <span class="Other">(</span><span class="Identifier">request</span><span class="Other">:</span> <a href="obiwan.html#Request"><span class="Identifier">Request</span></a><span class="Other">)</span><span class="Other">;</span>
           <span class="Identifier">address</span> <span class="Other">=</span> <span class="StringLit">&quot;&quot;</span><span class="Other">)</span> {.<span><span class="Other pragmadots">...</span></span><span class="pragmawrap"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Identifier">ObiwanError</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Identifier">RootEffect</span><span class="Other">]</span><span class="Other">,</span>
                           <span class="Identifier">forbids</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span>.}</pre></dt>
  <dd>
    
    <p>Starts a synchronous Gemini protocol server on the specified port.</p>
<p>This function starts a server that listens for incoming Gemini protocol requests. For each connection, it handles the TLS handshake, reads the request, and calls the provided callback function with a Request object. The callback is responsible for calling respond() to send a response.</p>
<p>Note that this is a blocking operation that runs indefinitely until the process is terminated.</p>
<p>Parameters: server: The ObiwanServer instance created with newObiwanServer() port: The port to listen on (standard Gemini port is 1965) callback: A procedure to call for each received request address: Optional IP address to bind to (default: &quot;0.0.0.0&quot;). Use &quot;::&quot; for IPv6 with possible dual-stack support (IPv4+IPv6) if supported by the operating system.</p>
<p>Raises: ObiwanError: If the server fails to bind to the specified port</p>
<p>Example:</p>
<p><pre class="listing"><span class="Keyword">proc</span> <span class="Identifier">handleRequest</span><span class="Punctuation">(</span><span class="Identifier">req</span><span class="Punctuation">:</span> <span class="Identifier">Request</span><span class="Punctuation">)</span> <span class="Operator">=</span>
  <span class="Identifier">req</span><span class="Operator">.</span><span class="Identifier">respond</span><span class="Punctuation">(</span><span class="Identifier">Status</span><span class="Operator">.</span><span class="Identifier">Success</span><span class="Punctuation">,</span> <span class="StringLit">&quot;text/gemini&quot;</span><span class="Punctuation">,</span> <span class="StringLit">&quot;# Hello from my Gemini server!&quot;</span><span class="Punctuation">)</span>

<span class="Keyword">let</span> <span class="Identifier">server</span> <span class="Operator">=</span> <span class="Identifier">newObiwanServer</span><span class="Punctuation">(</span><span class="Identifier">certFile</span><span class="Operator">=</span><span class="StringLit">&quot;server.crt&quot;</span><span class="Punctuation">,</span> <span class="Identifier">keyFile</span><span class="Operator">=</span><span class="StringLit">&quot;server.key&quot;</span><span class="Punctuation">)</span>
<span class="Identifier">server</span><span class="Operator">.</span><span class="Identifier">serve</span><span class="Punctuation">(</span><span class="DecNumber">1965</span><span class="Punctuation">,</span> <span class="Identifier">handleRequest</span><span class="Punctuation">)</span></pre></p>

    
  </dd>
</div>

</div>

  </dl>
</div>

  </div>
</div>

      <div class="twelve-columns footer">
        <span class="nim-sprite"></span>
        <br>
        <small style="color: var(--hint);">Made with Nim. Generated: 2025-03-20 23:33:22 UTC</small>
      </div>
    </div>
  </div>
  
</body>
</html>
